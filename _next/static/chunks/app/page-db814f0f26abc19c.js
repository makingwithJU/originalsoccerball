(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{979:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>R});var r=n(5155),l=n(2115),a=n(5339),i=n(258),s=n(6923),o=n(8473);let d=["hex","hex","hex","hex","hex","hex","hex","hex","hex","hex","hex","hex","hex","hex","hex","hex","hex","hex","hex","hex","pent","pent","pent","pent","pent","pent","pent","pent","pent","pent","pent","pent"];function c(e){var t;return null!=(t=d[e])?t:"hex"}let u=[[0,2,18,42,38,14],[1,3,17,41,37,13],[2,0,12,36,40,16],[3,1,15,39,43,19],[4,5,23,47,45,21],[5,4,20,44,46,22],[6,7,26,50,48,24],[7,6,25,49,51,27],[8,9,33,57,56,32],[9,8,28,52,53,29],[10,11,31,55,54,30],[11,10,34,58,59,35],[12,44,20,52,28,36],[13,37,29,53,21,45],[14,38,30,54,22,46],[15,47,23,55,31,39],[16,40,32,56,24,48],[17,49,25,57,33,41],[18,50,26,58,34,42],[19,43,35,59,27,51],[0,14,46,44,12],[1,13,45,47,15],[2,16,48,50,18],[3,19,51,49,17],[4,21,53,52,20],[5,22,54,55,23],[6,24,56,57,25],[7,27,59,58,26],[8,32,40,36,28],[9,29,37,41,33],[10,30,38,42,34],[11,35,43,39,31]],m=Math.sqrt(2*(29+9*Math.sqrt(5)))/4,p=[[.5,0,2.4270509831248424],[.5,0,-2.4270509831248424],[-.5,0,2.4270509831248424],[-.5,0,-2.4270509831248424],[2.4270509831248424,.5,0],[2.4270509831248424,-.5,0],[-2.4270509831248424,.5,0],[-2.4270509831248424,-.5,0],[0,2.4270509831248424,.5],[0,2.4270509831248424,-.5],[0,-2.4270509831248424,.5],[0,-2.4270509831248424,-.5],[1,.8090169943749475,2.118033988749895],[1,.8090169943749475,-2.118033988749895],[1,-.8090169943749475,2.118033988749895],[1,-.8090169943749475,-2.118033988749895],[-1,.8090169943749475,2.118033988749895],[-1,.8090169943749475,-2.118033988749895],[-1,-.8090169943749475,2.118033988749895],[-1,-.8090169943749475,-2.118033988749895],[2.118033988749895,1,.8090169943749475],[2.118033988749895,1,-.8090169943749475],[2.118033988749895,-1,.8090169943749475],[2.118033988749895,-1,-.8090169943749475],[-2.118033988749895,1,.8090169943749475],[-2.118033988749895,1,-.8090169943749475],[-2.118033988749895,-1,.8090169943749475],[-2.118033988749895,-1,-.8090169943749475],[.8090169943749475,2.118033988749895,1],[.8090169943749475,2.118033988749895,-1],[.8090169943749475,-2.118033988749895,1],[.8090169943749475,-2.118033988749895,-1],[-.8090169943749475,2.118033988749895,1],[-.8090169943749475,2.118033988749895,-1],[-.8090169943749475,-2.118033988749895,1],[-.8090169943749475,-2.118033988749895,-1],[.5,1.618033988749895,1.8090169943749475],[.5,1.618033988749895,-1.8090169943749475],[.5,-1.618033988749895,1.8090169943749475],[.5,-1.618033988749895,-1.8090169943749475],[-.5,1.618033988749895,1.8090169943749475],[-.5,1.618033988749895,-1.8090169943749475],[-.5,-1.618033988749895,1.8090169943749475],[-.5,-1.618033988749895,-1.8090169943749475],[1.8090169943749475,.5,1.618033988749895],[1.8090169943749475,.5,-1.618033988749895],[1.8090169943749475,-.5,1.618033988749895],[1.8090169943749475,-.5,-1.618033988749895],[-1.8090169943749475,.5,1.618033988749895],[-1.8090169943749475,.5,-1.618033988749895],[-1.8090169943749475,-.5,1.618033988749895],[-1.8090169943749475,-.5,-1.618033988749895],[1.618033988749895,1.8090169943749475,.5],[1.618033988749895,1.8090169943749475,-.5],[1.618033988749895,-1.8090169943749475,.5],[1.618033988749895,-1.8090169943749475,-.5],[-1.618033988749895,1.8090169943749475,.5],[-1.618033988749895,1.8090169943749475,-.5],[-1.618033988749895,-1.8090169943749475,.5],[-1.618033988749895,-1.8090169943749475,-.5]].map(e=>{let[t,n,r]=e;return new a.Pq0(t/m,n/m,r/m)}),v=[];for(let e=0;e<u.length;e++){let t=u[e],n=1.012+.005*(5===t.length),r=t.map(e=>p[e].clone().normalize().multiplyScalar(n)),l=r.reduce((e,t)=>e.add(t),new a.Pq0).multiplyScalar(1/r.length),i=l.clone().normalize(),s=Math.abs(i.y)>.9?new a.Pq0(1,0,0):new a.Pq0(0,1,0),o=new a.Pq0().crossVectors(s,i).normalize(),d=new a.Pq0().crossVectors(i,o).normalize(),m=t.map((e,t)=>{let n=r[t].clone().sub(l),a=n.dot(o),i=n.dot(d);return{idx:e,uu:a,vv:i,ang:Math.atan2(i,a)}}).sort((e,t)=>e.ang-t.ang),f=0;for(let e=1;e<m.length;e++)m[e].vv>m[f].vv&&(f=e);let h=[...m.slice(f),...m.slice(0,f)],x=Math.max(...h.map(e=>Math.hypot(e.uu,e.vv)))||1,g=h.map(e=>({x:.5+1.005*e.uu/(2*x),y:.5+1.005*e.vv/(2*x)})),w=h.map(e=>e.idx);v.push({shape:c(e),uv:g,indices:w})}let f=v.map(e=>{let{shape:t,uv:n}=e;return{shape:t,uv:n}}),h=[[.5,0,2.4270509831248424],[.5,0,-2.4270509831248424],[-.5,0,2.4270509831248424],[-.5,0,-2.4270509831248424],[2.4270509831248424,.5,0],[2.4270509831248424,-.5,0],[-2.4270509831248424,.5,0],[-2.4270509831248424,-.5,0],[0,2.4270509831248424,.5],[0,2.4270509831248424,-.5],[0,-2.4270509831248424,.5],[0,-2.4270509831248424,-.5],[1,.8090169943749475,2.118033988749895],[1,.8090169943749475,-2.118033988749895],[1,-.8090169943749475,2.118033988749895],[1,-.8090169943749475,-2.118033988749895],[-1,.8090169943749475,2.118033988749895],[-1,.8090169943749475,-2.118033988749895],[-1,-.8090169943749475,2.118033988749895],[-1,-.8090169943749475,-2.118033988749895],[2.118033988749895,1,.8090169943749475],[2.118033988749895,1,-.8090169943749475],[2.118033988749895,-1,.8090169943749475],[2.118033988749895,-1,-.8090169943749475],[-2.118033988749895,1,.8090169943749475],[-2.118033988749895,1,-.8090169943749475],[-2.118033988749895,-1,.8090169943749475],[-2.118033988749895,-1,-.8090169943749475],[.8090169943749475,2.118033988749895,1],[.8090169943749475,2.118033988749895,-1],[.8090169943749475,-2.118033988749895,1],[.8090169943749475,-2.118033988749895,-1],[-.8090169943749475,2.118033988749895,1],[-.8090169943749475,2.118033988749895,-1],[-.8090169943749475,-2.118033988749895,1],[-.8090169943749475,-2.118033988749895,-1],[.5,1.618033988749895,1.8090169943749475],[.5,1.618033988749895,-1.8090169943749475],[.5,-1.618033988749895,1.8090169943749475],[.5,-1.618033988749895,-1.8090169943749475],[-.5,1.618033988749895,1.8090169943749475],[-.5,1.618033988749895,-1.8090169943749475],[-.5,-1.618033988749895,1.8090169943749475],[-.5,-1.618033988749895,-1.8090169943749475],[1.8090169943749475,.5,1.618033988749895],[1.8090169943749475,.5,-1.618033988749895],[1.8090169943749475,-.5,1.618033988749895],[1.8090169943749475,-.5,-1.618033988749895],[-1.8090169943749475,.5,1.618033988749895],[-1.8090169943749475,.5,-1.618033988749895],[-1.8090169943749475,-.5,1.618033988749895],[-1.8090169943749475,-.5,-1.618033988749895],[1.618033988749895,1.8090169943749475,.5],[1.618033988749895,1.8090169943749475,-.5],[1.618033988749895,-1.8090169943749475,.5],[1.618033988749895,-1.8090169943749475,-.5],[-1.618033988749895,1.8090169943749475,.5],[-1.618033988749895,1.8090169943749475,-.5],[-1.618033988749895,-1.8090169943749475,.5],[-1.618033988749895,-1.8090169943749475,-.5]],x=Math.sqrt(2*(29+9*Math.sqrt(5)))/4;function g(e){let{textures:t,activeIndex:n,onPick:d}=e,{panels:c,edgeMaterial:u,edgeGeom:m}=(0,l.useMemo)(()=>{let e=h.map(e=>{let[t,n,r]=e;return new a.Pq0(t/x,n/x,r/x)}),t=v.map((t,n)=>(t=>{let n=v[t],r=n.indices,l=n.uv,i=1.012+.005*(5===r.length),s=r.map(t=>e[t].clone().normalize().multiplyScalar(i)),o=s.reduce((e,t)=>e.add(t),new a.Pq0).multiplyScalar(1/s.length),d=o.clone().normalize(),c=Math.abs(d.y)>.9?new a.Pq0(1,0,0):new a.Pq0(0,1,0),u=new a.Pq0().crossVectors(c,d).normalize(),m=new a.Pq0().crossVectors(d,u).normalize(),p=e=>{let t=[o.x,o.y,o.z],n=[.5,.5],i=[d.x,d.y,d.z];for(let a=0;a<r.length;a++){var c;let r=s[a].clone().sub(o),p=r.dot(u),v=r.dot(m),f=o.clone().add(u.clone().multiplyScalar(p*e)).add(m.clone().multiplyScalar(v*e));t.push(f.x,f.y,f.z);let h=null!=(c=l[a])?c:{x:.5,y:.5};n.push(h.x,h.y),i.push(d.x,d.y,d.z)}let p=[];for(let e=1;e<=r.length;e++){let t=e,n=e===r.length?1:e+1;p.push(0,t,n)}let v=new a.LoY;return v.setAttribute("position",new a.qtW(t,3)),v.setAttribute("uv",new a.qtW(n,2)),v.setAttribute("normal",new a.qtW(i,3)),v.setIndex(p),v.computeBoundingSphere(),v};return{geom:p(1.005),highlightGeom:p(1),center:o.clone().normalize().multiplyScalar(1.012),normal:d}})(n)),n=new Set,r=[];for(let t of v){let l=t.indices;for(let t=0;t<l.length;t++){let a=l[t],i=l[(t+1)%l.length],s=a<i?"".concat(a,",").concat(i):"".concat(i,",").concat(a);if(n.has(s))continue;n.add(s);let o=e[a].clone().normalize().multiplyScalar(1.012),d=e[i].clone().normalize().multiplyScalar(1.012);r.push(o.x,o.y,o.z,d.x,d.y,d.z)}}let l=new a.LoY;return l.setAttribute("position",new a.qtW(r,3)),{panels:t,edgeMaterial:new a.mrM({color:"#ffffff",depthWrite:!1}),edgeGeom:l}},[]);return(0,r.jsxs)(i.Hl,{shadows:!0,dpr:[1,1.5],camera:{position:[0,0,3.4],fov:45},style:{width:"100%",height:"100%"},children:[(0,r.jsxs)("group",{scale:[-1,1,1],children:[(0,r.jsxs)("mesh",{renderOrder:-1,children:[(0,r.jsx)("sphereGeometry",{args:[1.0108,1,1]}),(0,r.jsx)("meshBasicMaterial",{colorWrite:!1,depthWrite:!0,depthTest:!0,transparent:!0,opacity:0})]}),(0,r.jsx)("lineSegments",{geometry:m,material:u,renderOrder:1}),(0,r.jsx)("group",{children:c.map((e,l)=>{var i;let{geom:o,highlightGeom:c,center:u,normal:m}=e,p=new a.PTz().setFromUnitVectors(new a.Pq0(0,0,1),m.clone().normalize()),v=u.clone().add(m.clone().multiplyScalar(-.003)).toArray();return(0,r.jsxs)("group",{renderOrder:2,children:[(0,r.jsx)("mesh",{geometry:o,renderOrder:2,onPointerDown:e=>{var t,n;let r=null==(n=e.face)||null==(t=n.normal)?void 0:t.clone(),i=null==r?void 0:r.applyNormalMatrix(new a.dwI().getNormalMatrix(e.object.matrixWorld));(!i||0>i.dot(e.ray.direction))&&(null==d||d(l,String(l+1).padStart(2,"0")))},onPointerOver:()=>{document.body.style.cursor="pointer"},onPointerOut:()=>{document.body.style.cursor="default"},children:(0,r.jsx)("meshBasicMaterial",{map:null!=(i=t[l])?i:void 0,color:"#ffffff",transparent:!0,opacity:+!!t[l],depthWrite:!1,depthTest:!1,side:a.$EB})}),l===n&&(0,r.jsx)("mesh",{geometry:c,renderOrder:3,children:(0,r.jsx)("meshBasicMaterial",{color:"#f5c400",transparent:!0,opacity:.35,depthWrite:!1,depthTest:!1,side:a.$EB})}),(0,r.jsx)("group",{position:v,quaternion:p,scale:[-1,1,1],children:(0,r.jsx)(s.E,{color:"#fff",fontSize:.08,anchorX:"center",anchorY:"middle",textAlign:"center",renderOrder:2,depthOffset:-.002,outlineWidth:.004,outlineColor:"#000","material-transparent":!0,"material-depthWrite":!1,"material-depthTest":!0,"material-toneMapped":!1,children:String(l+1).padStart(2,"0")})})]},l)})})]}),(0,r.jsx)(o.V,{makeDefault:!0,noPan:!0,noZoom:!1,dynamicDampingFactor:.12,rotateSpeed:2.2,zoomSpeed:.9,staticMoving:!1})]})}function w(e,t,n,r){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1024,a=document.createElement("canvas");a.width=l,a.height=l;let i=a.getContext("2d");if(!i)throw Error("Canvas 2D context not available");i.setTransform(1,0,0,1,0,0),i.globalCompositeOperation="source-over",i.clearRect(0,0,l,l),i.imageSmoothingEnabled=!0,i.fillStyle="#ffffff",i.fillRect(0,0,l,l);let s=t.length?t:"pent"===r?[{x:.5,y:.05},{x:.95,y:.38},{x:.77,y:.95},{x:.23,y:.95},{x:.05,y:.38}]:[{x:.25,y:.03},{x:.75,y:.03},{x:.98,y:.5},{x:.75,y:.97},{x:.25,y:.97},{x:.02,y:.5}],o=s.reduce((e,t)=>e+t.x,0)/s.length,d=s.reduce((e,t)=>e+t.y,0)/s.length,c=Math.max(...s.map(e=>Math.hypot((e.x-o)*l,(e.y-d)*l)))||.45*l;i.save(),i.beginPath(),s.forEach((e,t)=>{let n=e.x*l,r=e.y*l;0===t?i.moveTo(n,r):i.lineTo(n,r)}),i.closePath(),i.save(),i.clip(),i.save();let u=n.offsetX*c,m=n.offsetY*c;i.translate(o*l+u,d*l+m),i.rotate(n.rotation*Math.PI/180),n.reflect&&i.scale(-1,1);let p=2*c*n.scale,v=e.width/e.height||1,f=p,h=p;return v>=1?(f=p,h=p/v):(h=p,f=p*v),i.drawImage(e,-f/2,-h/2,f,h),i.restore(),i.restore(),{canvas:a,radiusPx:c}}function y(e){let t=new a.GOR(e);return t.flipY=!1,t.colorSpace=a.er$,t.anisotropy=4,t.needsUpdate=!0,t}function j(e){var t,n,a,i,s,o,d,u,m;let{activeIndex:p,panel:v}=e,{slots:h,setFileAt:x,updateTransform:g,clearAt:y,defaultTransform:j}=v,b=(0,l.useRef)(null),E=(0,l.useRef)(null),[L,N]=(0,l.useState)(null),R=(0,l.useMemo)(()=>null==p?"hex":c(p),[p]),C=(0,l.useCallback)((e,t,n,r)=>{var l,a;if(null==r)return null;let{canvas:i}=w(e,null!=(a=null==(l=f[r])?void 0:l.uv)?a:[],t,n);return i.toDataURL("image/png")},[]);(0,l.useEffect)(()=>()=>{E.current&&(URL.revokeObjectURL(E.current),E.current=null)},[]),(0,l.useEffect)(()=>{if(E.current&&(URL.revokeObjectURL(E.current),E.current=null),null==p)return void N(null);let e=h[p];(null==e?void 0:e.image)?N({file:null,previewUrl:C(e.image,e.transform,e.shape,p),image:e.image,transform:{...e.transform},shape:e.shape}):N({file:null,previewUrl:null,image:null,transform:j(),shape:R})},[p,h,j,R,C]);let P=(0,l.useMemo)(()=>{var e,t;if(null==p)return null;let n=null!=(t=null==(e=f[p])?void 0:e.uv)?t:[];return n.length?n.map(e=>"".concat((100*e.x).toFixed(1),"% ").concat((100*e.y).toFixed(1),"%")).join(", "):null},[p]),U=P?"polygon(".concat(P,")"):(null==L?void 0:L.shape)==="pent"?"polygon(50% 2%, 95% 38%, 77% 98%, 23% 98%, 5% 38%)":"polygon(25% 2%, 75% 2%, 98% 50%, 75% 98%, 25% 98%, 2% 50%)",k=!!(null==L?void 0:L.previewUrl),M=(0,l.useCallback)(e=>{E.current&&(URL.revokeObjectURL(E.current),E.current=null);let t=URL.createObjectURL(e);E.current=t;let n=new Image;n.onload=()=>{let r=j(),l=C(n,r,R,p);N({file:e,previewUrl:null!=l?l:t,image:n,transform:r,shape:R})},n.src=t},[R,j,C,p]),S=(0,l.useCallback)(e=>{var t;let n=null==(t=e.target.files)?void 0:t[0];n&&M(n),e.target.value=""},[M]),O=(0,l.useCallback)(e=>{var t;e.preventDefault();let n=null==(t=e.dataTransfer.files)?void 0:t[0];n&&M(n)},[M]),D=(0,l.useCallback)(async()=>{null!=p&&L&&(L.file&&await x(p,L.file,L.transform),await g(p,L.transform))},[p,L,x,g]),T=(0,l.useCallback)(()=>{null!=p&&(y(p),N({file:null,previewUrl:null,image:null,transform:j(),shape:R}),E.current&&(URL.revokeObjectURL(E.current),E.current=null))},[p,y,j,R]),z=(0,l.useCallback)(e=>{if(N(t=>{if(!t)return t;let n={...t.transform,...e},r=t.previewUrl;if(t.image&&null!=p){var l;r=null!=(l=C(t.image,n,t.shape,p))?l:t.previewUrl}return{...t,transform:n,previewUrl:r}}),null!=p){let n=h[p];if((null==n?void 0:n.image)&&!(null==L?void 0:L.file)){var t;g(p,{...null!=(t=null==L?void 0:L.transform)?t:j(),...e})}}},[p,h,null==L?void 0:L.file,null==L?void 0:L.transform,j,g,C]);return(0,r.jsxs)("div",{className:"panelCard",children:[(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:8,marginBottom:8},children:(0,r.jsx)("div",{className:"counter",style:{fontSize:9},children:null==p?"パネルを選択してください":(0,r.jsxs)("div",{style:{display:"grid",gap:2},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,color:"#000"},children:[(0,r.jsx)("span",{className:"deviceBadge",children:"PC"}),(0,r.jsx)("span",{children:"クリックして画像をアップロード"})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,color:"#000"},children:[(0,r.jsx)("span",{className:"deviceBadge",children:"Mobile"}),(0,r.jsx)("span",{children:"タップして画像をアップロード"})]})]})})}),null==p?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"editorDrop",onDragOver:e=>e.preventDefault(),onDrop:O,onClick:()=>{var e;return null==(e=b.current)?void 0:e.click()},children:(0,r.jsx)("div",{className:"shapeMask",style:{clipPath:U,WebkitClipPath:U},children:(0,r.jsx)("div",{className:"shapeInner",children:k&&(0,r.jsx)("img",{src:null!=(t=null==L?void 0:L.previewUrl)?t:void 0,alt:"",className:"previewImage"})})})}),(0,r.jsxs)("div",{className:"controlRow",children:[(0,r.jsx)("label",{className:"rangeLabel",children:"拡大縮小"}),(0,r.jsx)("input",{type:"range",min:.5,max:2.5,step:.01,value:null!=(n=null==L?void 0:L.transform.scale)?n:1,onChange:e=>z({scale:Number(e.target.value)})}),(0,r.jsxs)("div",{className:"counter",children:[(null!=(a=null==L?void 0:L.transform.scale)?a:1).toFixed(2),"x"]})]}),(0,r.jsxs)("div",{className:"controlRow",children:[(0,r.jsx)("label",{className:"rangeLabel",children:"回転"}),(0,r.jsx)("input",{type:"range",min:-180,max:180,step:1,value:null!=(i=null==L?void 0:L.transform.rotation)?i:0,onChange:e=>z({rotation:Number(e.target.value)})}),(0,r.jsxs)("div",{className:"counter",children:[Math.round(null!=(s=null==L?void 0:L.transform.rotation)?s:0),"\xb0"]})]}),(0,r.jsxs)("div",{className:"controlRow",children:[(0,r.jsx)("label",{className:"rangeLabel",children:"左右位置"}),(0,r.jsx)("input",{type:"range",min:-.6,max:.6,step:.01,value:null!=(o=null==L?void 0:L.transform.offsetX)?o:0,onChange:e=>z({offsetX:Number(e.target.value)})}),(0,r.jsx)("div",{className:"counter",children:(null!=(d=null==L?void 0:L.transform.offsetX)?d:0).toFixed(2)})]}),(0,r.jsxs)("div",{className:"controlRow",children:[(0,r.jsx)("label",{className:"rangeLabel",children:"上下位置"}),(0,r.jsx)("input",{type:"range",min:-.6,max:.6,step:.01,value:null!=(u=null==L?void 0:L.transform.offsetY)?u:0,onChange:e=>z({offsetY:Number(e.target.value)})}),(0,r.jsx)("div",{className:"counter",children:(null!=(m=null==L?void 0:L.transform.offsetY)?m:0).toFixed(2)})]}),(0,r.jsxs)("div",{className:"controlRow",children:[(0,r.jsx)("label",{className:"rangeLabel",children:"リフレクト"}),(0,r.jsx)("input",{type:"range",min:0,max:100,step:100,value:100*(null!=L&&!!L.transform.reflect),onChange:e=>z({reflect:100===Number(e.target.value)})}),(0,r.jsx)("div",{className:"counter",children:(null==L?void 0:L.transform.reflect)?"ON":"OFF"})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:8,marginTop:12,flexWrap:"wrap"},children:[(0,r.jsx)("button",{className:"button",onClick:D,disabled:!k,children:"画像を反映"}),(0,r.jsx)("button",{className:"button",onClick:T,disabled:!k,children:"画像を削除"})]}),(0,r.jsx)("input",{ref:b,type:"file",accept:"image/*",style:{display:"none"},onChange:S})]})]})}let b=()=>({scale:1,rotation:0,offsetX:0,offsetY:0,reflect:!1}),E=e=>({file:null,url:void 0,image:null,texture:null,transform:b(),shape:e});function L(e){return new Promise((t,n)=>{let r=new Image;r.onload=()=>t(r),r.onerror=e=>n(e),r.src=e})}async function N(e){let t=URL.createObjectURL(e),n=await L(t),r=Math.max(n.width,n.height);if(r<=2048)return{url:t,image:n};let l=2048/r,a=Math.round(n.width*l),i=Math.round(n.height*l),s=document.createElement("canvas");s.width=a,s.height=i;let o=s.getContext("2d");if(!o)throw Error("Canvas 2D context not available");o.setTransform(1,0,0,1,0,0),o.globalCompositeOperation="source-over",o.imageSmoothingEnabled=!0,o.clearRect(0,0,a,i),o.drawImage(n,0,0,a,i);let d=await new Promise((e,t)=>{s.toBlob(n=>n?e(n):t(Error("Failed to compress image")),"image/jpeg",.9)}),c=URL.createObjectURL(d);URL.revokeObjectURL(t);let u=await L(c);return{url:c,image:u}}function R(){var e;let t=function(){let e=(0,l.useMemo)(()=>d.map(e=>E(e)),[]),[t,n]=(0,l.useState)(e),r=(0,l.useRef)([]),a=(0,l.useRef)(e);async function i(e,t,l){var a,i;let{url:s,image:o}=await N(t),d=c(e),u=null!=(i=null==(a=f[e])?void 0:a.uv)?i:[],m=l?{...l}:b(),{canvas:p}=w(o,u,m,d),v=y(p);r.current.push(s),n(n=>{var r;let l=[...n],a=l[e];return a?(a.url&&a.url!==s&&URL.revokeObjectURL(a.url),null==(r=a.texture)||r.dispose(),l[e]={file:t,url:s,image:o,texture:v,transform:m,shape:d},l):n})}async function s(e,t){n(n=>{var r,l,a;let i=[...n],s=i[e];if(!s||!s.image)return n;let o=null!=(a=null==(r=f[e])?void 0:r.uv)?a:[],{canvas:d}=w(s.image,o,t,s.shape),c=y(d);return null==(l=s.texture)||l.dispose(),i[e]={...s,texture:c,transform:{...t}},i})}async function o(e){let t=Array.from(e);t.sort((e,t)=>e.name.localeCompare(t.name,void 0,{numeric:!0}));let n=t.slice(0,32).map((e,t)=>i(t,e));await Promise.allSettled(n)}(0,l.useEffect)(()=>{a.current=t},[t]),(0,l.useEffect)(()=>()=>{r.current.forEach(e=>URL.revokeObjectURL(e)),r.current=[],a.current.forEach(e=>{var t;return null==(t=e.texture)?void 0:t.dispose()})},[]);let u=(0,l.useMemo)(()=>t.map(e=>e.texture||null),[t]),m=(0,l.useMemo)(()=>t.filter(e=>!!e.texture).length,[t]);return{slots:t,textures:u,count:m,setFileAt:i,setBulk:o,clearAt:function(e){n(t=>{var n;let r=[...t],l=r[e];return l?(l.url&&URL.revokeObjectURL(l.url),null==(n=l.texture)||n.dispose(),r[e]=E(l.shape),r):t})},clearAll:function(){n(e=>(e.forEach(e=>{var t;e.url&&URL.revokeObjectURL(e.url),null==(t=e.texture)||t.dispose()}),d.map(e=>E(e))))},updateTransform:s,defaultTransform:b}}(),[n,a]=(0,l.useState)({index:null,name:null}),i=(0,l.useRef)(null),s=(0,l.useRef)(null),[o,u]=(0,l.useState)(()=>(window.innerWidth||0)>=(window.innerHeight||0)),[m,p]=(0,l.useState)(!1),v=(0,l.useCallback)(async e=>{var r;if(null==n.index)return;let l=null==(r=e.target.files)?void 0:r[0];l&&await t.setFileAt(n.index,l),e.target.value=""},[n.index,t]),h=(0,l.useCallback)(e=>{var r,l;e.preventDefault(),e.stopPropagation(),p(!1);let a=null==(l=e.dataTransfer)||null==(r=l.files)?void 0:r[0];a&&null!=n.index&&t.setFileAt(n.index,a)},[n.index,t]),x=(0,l.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),p(!0)},[]),L=(0,l.useCallback)(e=>{e.preventDefault(),p(!1)},[]);return(0,l.useEffect)(()=>{let e=e=>{e.cancelable&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),p(!0)},r=e=>{var r,l;e.cancelable&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),p(!1);let a=null==(l=e.dataTransfer)||null==(r=l.files)?void 0:r[0];a&&null!=n.index&&t.setFileAt(n.index,a)},l=["dragover","dragenter"];l.forEach(t=>{var n;window.addEventListener(t,e,{passive:!1,capture:!0}),document.addEventListener(t,e,{passive:!1,capture:!0}),null==(n=document.body)||n.addEventListener(t,e,{passive:!1,capture:!0})}),["drop"].forEach(e=>{var t;window.addEventListener(e,r,{passive:!1,capture:!0}),document.addEventListener(e,r,{passive:!1,capture:!0}),null==(t=document.body)||t.addEventListener(e,r,{passive:!1,capture:!0})});let a=s.current,i=e=>{e.cancelable&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),p(!0)},o=e=>{var r,l;e.cancelable&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),p(!1);let a=null==(l=e.dataTransfer)||null==(r=l.files)?void 0:r[0];a&&null!=n.index&&t.setFileAt(n.index,a)};return a&&(a.addEventListener("dragover",i,{passive:!1,capture:!0}),a.addEventListener("dragenter",i,{passive:!1,capture:!0}),a.addEventListener("drop",o,{passive:!1,capture:!0})),()=>{l.forEach(t=>{var n;window.removeEventListener(t,e,!0),document.removeEventListener(t,e,!0),null==(n=document.body)||n.removeEventListener(t,e,!0)}),["drop"].forEach(e=>{var t;window.removeEventListener(e,r,!0),document.removeEventListener(e,r,!0),null==(t=document.body)||t.removeEventListener(e,r,!0)}),a&&(a.removeEventListener("dragover",i,!0),a.removeEventListener("dragenter",i,!0),a.removeEventListener("drop",o,!0))}},[n.index,t]),(0,l.useEffect)(()=>{let e=e=>{e.preventDefault(),p(!0)},r=e=>{var r,l;e.preventDefault(),p(!1);let a=null==(l=e.dataTransfer)||null==(r=l.files)?void 0:r[0];null!=a&&null!=n.index&&t.setFileAt(n.index,a)},l=()=>p(!1);return window.addEventListener("dragover",e,{passive:!1}),window.addEventListener("dragenter",e,{passive:!1}),window.addEventListener("drop",r,{passive:!1}),window.addEventListener("dragleave",l),()=>{window.removeEventListener("dragover",e),window.removeEventListener("dragenter",e),window.removeEventListener("drop",r),window.removeEventListener("dragleave",l)}},[n.index,t]),(0,l.useEffect)(()=>{let e=e=>{let r=e.data;if(!r||"simulator-drop"!==r.type)return;let l=r.file;l&&null!=n.index&&t.setFileAt(n.index,l)};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[n.index,t]),(0,l.useLayoutEffect)(()=>{let e=window.matchMedia("(orientation: landscape)"),t=()=>{let t=(window.innerWidth||0)>=(window.innerHeight||0);u(e.matches||t)};return t(),e.addEventListener("change",t),window.addEventListener("resize",t),window.addEventListener("orientationchange",t),()=>{e.removeEventListener("change",t),window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t)}},[]),(0,r.jsxs)("div",{className:"container",children:[(0,r.jsxs)("header",{className:"header",children:[(0,r.jsxs)("h1",{className:"title",style:{color:"#fff"},children:["fullcolorballs simulator",(0,r.jsx)("span",{className:"badge",children:"FREE EDITION"})]}),(0,r.jsx)("div",{className:"toolbar",children:(0,r.jsx)("input",{ref:i,type:"file",accept:"image/*",style:{display:"none"},onChange:v})})]}),(0,r.jsxs)("main",{className:"main",style:o?{display:"grid",gridTemplateColumns:"1fr 360px",gridAutoFlow:"column",gap:"16px",alignItems:"start"}:void 0,children:[(0,r.jsxs)("section",{className:"canvasWrap",style:o?{gridColumn:"1",height:"70vh",minHeight:"420px"}:void 0,ref:s,"aria-label":"viewer",onDragOver:x,onDragEnter:x,onDragLeave:L,onDrop:h,children:[(0,r.jsx)("div",{className:"dropMask"+(m?" show":""),style:{background:m?"rgba(245,196,0,0.08)":"transparent"}}),(0,r.jsx)(g,{textures:t.textures,activeIndex:null!=(e=n.index)?e:void 0,onPick:(e,t)=>a({index:e,name:t})}),(0,r.jsx)("div",{className:"watermark",children:"\xa9 2006 originalsoccerball.com「JUGEND」 All rights reserved."})]}),(0,r.jsxs)("aside",{children:[(0,r.jsxs)("div",{className:"panelCard",style:{marginBottom:12},children:[(0,r.jsx)("strong",{children:"選択中パネル："})," ",null==n.index?"（未選択）":"#".concat(String(n.index+1).padStart(2,"0"))]}),(0,r.jsx)(j,{activeIndex:n.index,activeName:n.name,panel:t})]})]})]})}},7513:(e,t,n)=>{Promise.resolve().then(n.bind(n,979))}},e=>{e.O(0,[367,831,683,413,913,441,255,358],()=>e(e.s=7513)),_N_E=e.O()}]);